小⽶穿戴第三⽅ APP 能⼒开放接口⽂档 _v1.4  
1.4版本更新⽇志  
兼容 Android R
1.3版本更新⽇志  
兼容未来小⽶穿戴和小⽶健康合并项⽬， api ⽆变化，直接替换 sdk 即可
1.2版本更新⽇志：  
兼容 jdk1.7 版本， api 没有变化
1.1版本更新⽇志：  
1.修改状态订阅和状态查询相关接口返回值，详情请查看⽂档 3.2 和 3.3 部分
2.增加消息通知 api ，详情请看⽂档第 5 部分
1.查询已连接的可穿戴设备（不需要权限）  
2.权限查询与申请  
2.1查询授权状态  
第⼀次调⽤授权会默认授予 Permission.DEVICE_MANAGER 和 Permission.Notify 权限//先获取NodeApi 对象
NodeApi api = Wearable.getNodeApi(context);
//调⽤getConnectedNodes ⽅法获取已连接设备
api.getConnectedNodes().addOnSuccessListener(new OnSuccessListener<List<Node>>() 
{
    @Override
    public void onSuccess(List<Node> nodes) {
        //获取当前已连接的设备 , ⽬前⼀次只能连接⼀个设备      
    }
}).addOnFailureListener(new OnFailureListener() {
    @Override
    public void onFailure(@NonNull Exception e) {
        //获取已连接设备失败
    }
});
//先获取AuthApi 对象
AuthApi authApi = Wearable.getAuthApi(context);
//调⽤checkPermission ⽅法获取某个授权状态
authApi.checkPermission("nodeId",Permission.DEVICE_MANAGER)
        .addOnSuccessListener(new OnSuccessListener<Boolean>() {
            @Override
            public void onSuccess(Boolean result) {
                //如果已授权， result 为 true ，未授权 result 为 false
            }
        }).addOnFailureListener(new OnFailureListener() {
            @Override
2.2申请权限  
3.设备管理与状态订阅  
3.1⽀持查询与订阅的设备状态              public void onFailure(@NonNull Exception e ) {
                //获取授权失败
            }
});
//定义⼀组权限
Permission[] permissions = new Permission[]
{Permission.DEVICE_MANAGER,Permission.NOTIFY};
//调⽤checkPermissions 接口查询⼀组权限授权状态
authApi.checkPermissions("nodeId",permissions)
    .addOnSuccessListener(new OnSuccessListener<Boolean[]>() {
        @Override
        public void onSuccess(Boolean[] results) {
            //如果已授权， result 为 true ，未授权 result 为 false, 按照请求顺序返回结果
        }
    }).addOnFailureListener(new OnFailureListener() {
        @Override
        public void onFailure(@NonNull Exception e) {
            //获取授权状态失败
        }
});
//先获取AuthApi 对象
AuthApi authApi = Wearable.getAuthApi(context);
//发起授权申请
authApi.requestPermission("nodeId",Permission.DEVICE_MANAGER,Permission.NOTIFY)
        .addOnSuccessListener(new OnSuccessListener<Permission[]>() {
            @Override
            public void onSuccess(Permission[] permissions) {
               //申请权限成功，返回授权成功的权限
            }
        }).addOnFailureListener(new OnFailureListener() {
        @Override
            public void onFailure(@NonNull Exception e) {
                //申请权限失败
            }
        });
设备管理与状态订阅查询结果 订阅事件触发条件 订阅结果
连接状态1.连接  
2.未连接1.⼿机与设备连接成功   
2.⼿机与设备断开连接1.连接成功   
2.连接断开   
3.连接失败   
4.设备被删除
电量状态 电量值（ 0~100 ，⽐如 98 ） N/A N/A
充电状态1.正在充电   
2.⾮充电状态1.给设备充电   
2.充满电   
3.停⽌充电1.开始充电   
2.充电完成   
3.停⽌充电
佩戴状态1.佩戴中   
2.未佩戴1.⼿表戴在⼿腕上   
2.摘下⼿表1.佩戴   
2.未佩戴
睡眠状态1.睡眠中   
2.清醒1.佩戴⼿表⼊睡   
2.从⼊睡状态清醒过来1.⼊睡   
2.出睡
 
3.2状态查询（需要申请 Permission .DEVICE_MANAGER 权限）  
//先获取NodeApi 对象
NodeApi api = Wearable.getNodeApi(context);
//调⽤query ⽅法，查询不同状态， nodeId 通过查询已连接设备得到的设备 id
//⽬前⽀持查询（连接状态，电量状态，充电状态，佩戴状态，睡眠状态）
api.query("nodeId", DataItem.ITEM_CONNECTION)
     .addOnSuccessListener(new OnSuccessListener<DataQueryResult>() {
         @Override
         public void onSuccess(DataQueryResult result) {
             //查询成功
            boolean connectionStatus = result.isConnected;//DataQueryResult 定义了
各种状态的状态值，和 DataItem ⼀⼀对应
         }
     }).addOnFailureListener(new OnFailureListener() {
        @Override
        public void onFailure(@NonNull Exception e) {
            //查询失败
        }
    });
//查询对应的穿戴设备端应⽤是否安装
api.isWearAppInstalled("nodeId")
    .addOnSuccessListener(new OnSuccessListener<Boolean>() {
        @Override
        public void onSuccess(Boolean result) {
            //查询成功，应⽤已安装返回 true ，未安装返回 false
        }
    }).addOnFailureListener(new OnFailureListener() {
        @Override
        public void onFailure(@NonNull  Exception e) {
            //查询失败
        }
});
//打开设备端应⽤
//uri由各个应⽤⾃定义，⽤于打开⼿表端 app 的指定⻚⾯
api.launchWearApp("nodeId","uri")
3.3状态订阅（需要申请 Permission .DEVICE_MANAGER 权限）      .addOnSuccessListener(new OnSuccessListener<Void>() {
        @Override
        public void onSuccess(Void var1) {
            //打开穿戴设备端应⽤成功     
        }
    }).addOnFailureListener(new OnFailureListener() {
    @Override
    public void onFailure(@NonNull @NotNull Exception var1) {
        //打开穿戴设备端应⽤失败
    }
});
//先获取NodeApi 对象
NodeApi api = Wearable.getNodeApi(context);
//创建监听器
OnDataChangedListener onDataChangedListener = new OnDataChangedListener() {
    @Override
    public void onDataChanged(@NonNull String nodeId, @NonNull DataItem dataItem, 
@NonNull DataSubscribeResult data) {
        //收到订阅状态变更通知
        //不同的DataItem 对应 DataSubscribeResult 中不同的 status ，⼀⼀对应
        if(dataItem.getType() == DataItem.ITEM_CONNECTION.getType()){
            int connectionStatus = data.getConnectedStatus();
            if(connectionStatus == 
DataSubscribeResult.RESULT_CONNECTION_CONNECTED){
                //设备连接状态变更为已连接状态
            }
        }
    }
};
//调⽤subscribe ⽅法，订阅不同状态， nodeId 是通过查询已连接设备得到的设备 id
//⽬前⽀持订阅（连接状态变化，充电状态变化，佩戴状态变化，睡眠状态变化）
api.subscribe("nodeId", DataItem.ITEM_CONNECTION, onDataChangedListener)
    .addOnSuccessListener(new OnSuccessListener<Void>() {
        @Override
        public void onSuccess(Void var1) {
            //添加订阅成功
        }
    }).addOnFailureListener(new OnFailureListener() {
        @Override
        public void onFailure(@NonNull @NotNull Exception var1) {
            //添加订阅失败
        }
});
//调⽤unsubscribe ⽅法取消监听
api.unsubscribe("nodeId", DataItem.ITEM_CONNECTION)
    .addOnSuccessListener(new OnSuccessListener<Void>() {
        @Override
        public void onSuccess(Void var1) {
            //删除订阅成功
        }
    }).addOnFailureListener(new OnFailureListener() {
        @Override
        public void onFailure(@NonNull @NotNull Exception var1) {
4.应⽤间消息通信（需要申请 Permission.DEVICE_MANAGER 权
限）             //删除订阅失败
        }
});
//模拟数据，应⽤可以⾃定义发送数据
byte[] messageBytes = new byte[1024];
//获取MessageApi 对象
MessageApi messageApi = Wearable.getMessageApi(context);
//调⽤sendMessage ⽅法⽤来发送数据给穿戴设备端应⽤
messageApi.sendMessage("nodeId",messageBytes)
     .addOnSuccessListener(new OnSuccessListener<Integer>() {
         @Override
         public void onSuccess(Integer result) {
            //发送数据成功 
         }
     })
     .addOnFailureListener(new OnFailureListener() {
         @Override
         public void onFailure(@NonNull Exception e) {
            //发送数据失败
         }
     });
//传⻅监听器⽤于监听穿戴设备端发送来的消息
OnMessageReceivedListener onMessageReceivedListener = new 
OnMessageReceivedListener() {
    @Override
    public void onMessageReceived(@NotNull String nodeId,  @NotNull byte[] 
message) {
        //收到⼿表端应⽤发来的消息
    }
};
//监听穿戴设备端应⽤发来的消息
messageApi.addListener("nodeId", onMessageReceivedListener)
    .addOnSuccessListener(new OnSuccessListener<Void>() {
        @Override
        public void onSuccess(Void var1) {
            //添加消息监听成功
        }
    }).addOnFailureListener(new OnFailureListener() {
        @Override
        public void onFailure(@NonNull @NotNull Exception var1) {
            //添加消息监听失败
        }
});
//取消监听
messageApi.removeListener("nodeId",onMessageReceivedListener).addOnSuccessListene
r(new OnSuccessListener<Void>() {
    @Override
    public void onSuccess(Void var1) {
        //取消消息监听成功
    }
 
5.消息通知（需要 Permission .NOTIFY 权限）  
 
 
6.管理服务连接状态（不需要权限）  }).addOnFailureListener(new OnFailureListener() {
    @Override
    public void onFailure(@NonNull @NotNull Exception var1) {
        //取消消息监听失败
    }
});
//获取NotifyApi
NotifyApi notifyApi = Wearable.getNotifyApi(context);
//发送消息通知，需要提前判断是否有 Permission.NOTIFY 权限
notifyApi.sendNotify("nodeId","title","message")
        .addOnSuccessListener(new OnSuccessListener<Status>() {
            @Override
            public void onSuccess(Status status) {
                if(status.isSuccess()){
                    //发送通知成功 , ⼿表上会看到消息通知内容，表端应⽤⽆感知
                }
            }
        }).addOnFailureListener(new OnFailureListener() {
    @Override
    public void onFailure(@NonNull @NotNull Exception var1) {
       //发送通知失败 
    }
});
//获取ServiceApi
ServiceApi serviceApi = Wearable.getServiceApi(context);
//第三⽅应⽤与小⽶穿戴 App 连接状态可以通过这个监听器来监听
OnServiceConnectionListener onServiceConnectionListener = new 
OnServiceConnectionListener() {
    @Override
    public void onServiceConnected() {
        //服务连接成功
    }
    @Override
    public void onServiceDisconnected() {
        //服务断开
    }
};
//注册监听器
serviceApi.registerServiceConnectionListener(onServiceConnectionListener);
//取消监听器
serviceApi.unregisterServiceConnectionListener(onServiceConnectionListener);
 
 
 